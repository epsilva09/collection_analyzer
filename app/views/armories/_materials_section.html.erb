<% section_key = section_data[:key] %>
<% items = section_data[:items] %>
<% collapse_id = "materials-#{section_key}" %>
<% heading_id = "heading-materials-#{section_key}" %>

<div class="accordion-item mb-3 border-0 bg-transparent">
  <h2 class="accordion-header" id="<%= heading_id %>">
    <button
      class="accordion-button materials-title-btn <%= index.zero? ? '' : 'collapsed' %>"
      type="button"
      data-bs-toggle="collapse"
      data-bs-target="#<%= collapse_id %>"
      aria-expanded="<%= index.zero? ? 'true' : 'false' %>"
      aria-controls="<%= collapse_id %>">
      <span class="me-2"><%= section_data[:label] %></span>
      <span class="badge <%= section_key == :near ? 'bg-warning text-dark' : 'bg-secondary' %>"><%= items.size %></span>
    </button>
  </h2>

  <div
    id="<%= collapse_id %>"
    class="accordion-collapse collapse <%= index.zero? ? 'show' : '' %>"
    aria-labelledby="<%= heading_id %>">
    <div class="accordion-body p-0">
      <div class="table-responsive">
        <table class="table table-dark table-hover mb-0 align-middle">
          <thead>
            <tr>
              <th class="border-0"><%= t('armories.progress.top_materials.item') %></th>
              <th class="border-0 text-center"><%= t('armories.progress.top_materials.total_needed') %></th>
              <th class="border-0 text-center"><%= t('armories.progress.top_materials.collections_count') %></th>
            </tr>
          </thead>
          <tbody>
            <% items.each do |item| %>
              <% material_link = material_collections_armory_path(name: character_name, material: item[:name], bucket: (section_key == :general ? nil : section_key)) %>
              <tr>
                <td>
                  <%= link_to item[:name], material_link, class: 'fw-semibold text-decoration-none' %>
                </td>
                <td class="text-center fw-bold text-warning">
                  <%= item[:total_needed] %>
                </td>
                <td class="text-center">
                  <span class="badge bg-secondary"><%= item[:collections_count] %></span>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
