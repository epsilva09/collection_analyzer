<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title><%= t('armories.material_collections.page_title', material: @material_name.presence || '-') %></title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <%= stylesheet_link_tag 'application', media: 'all' %>
    <%= stylesheet_link_tag 'armory', media: 'all' %>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  </head>
  <body>
    <div class="container-fluid">
      <div class="row justify-content-center">
        <div class="col-12 col-md-10 col-lg-8">
          <main class="text-center">
            <%= render 'locale_switcher' %>

            <h1 class="my-4">
              <i class="fas fa-box-open me-2"></i>
              <%= t('armories.material_collections.heading', material: @material_name) %>
            </h1>

            <div class="row justify-content-center mb-3">
              <div class="col-12 text-center">
                <%= link_to t('armories.materials.heading'), materials_armory_path(name: @name), class: 'btn btn-outline-secondary btn-sm me-2' %>
                <%= link_to t('armories.progress.heading'), progress_armory_path(name: @name), class: 'btn btn-outline-secondary btn-sm me-2' %>
                <%= link_to t('armories.compare.actions.back_to_index'), armory_path, class: 'btn btn-outline-secondary btn-sm' %>
              </div>
            </div>

            <% if @error.present? %>
              <div class="alert alert-danger" role="alert">
                <strong><%= t('armories.progress.alerts.error') %>:</strong> <%= @error %>
              </div>
            <% end %>

            <% if @collections_for_material.present? %>
              <div class="card shadow-sm mt-3">
                <div class="card-header bg-dark text-white d-flex justify-content-between align-items-center">
                  <h2 class="h5 mb-0">
                    <i class="fas fa-list-ul me-2"></i>
                    <%= t('armories.material_collections.list_heading') %>
                  </h2>
                  <span class="badge bg-light text-dark"><%= @collections_for_material.size %></span>
                </div>
                <div class="card-body p-0">
                  <div class="table-responsive">
                    <table class="table table-dark table-hover mb-0 align-middle">
                      <thead>
                        <tr>
                          <th class="border-0"><%= t('armories.material_collections.table.collection') %></th>
                          <th class="border-0 text-center"><%= t('armories.material_collections.table.bucket') %></th>
                          <th class="border-0 text-center"><%= t('armories.progress.badges.progress') %></th>
                          <th class="border-0 text-center"><%= t('armories.progress.badges.missing') %></th>
                          <th class="border-0 text-center"><%= t('armories.material_collections.table.needed') %></th>
                        </tr>
                      </thead>
                      <tbody>
                        <% @collections_for_material.each do |col| %>
                          <tr>
                            <td class="text-start">
                              <strong><%= col[:tier] %> â€“ <%= col[:collection_name] %></strong>

                              <% badges_html = reward_badges(rewards: col[:rewards], status: col[:status]) %>
                              <% if badges_html.present? %>
                                <div class="mt-1">
                                  <%= badges_html %>
                                </div>
                              <% end %>
                            </td>
                            <td class="text-center">
                              <span class="badge <%= progress_bucket_badge_class(col[:bucket]) %>">
                                <%= progress_bucket_label(col[:bucket]) %>
                              </span>
                            </td>
                            <td class="text-center">
                              <span class="badge bg-secondary"><%= col[:progress] %>%</span>
                            </td>
                            <td class="text-center">
                              <span class="badge bg-info"><%= col[:missing] %>%</span>
                            </td>
                            <td class="text-center fw-bold text-warning">
                              +<%= col[:needed] %>
                            </td>
                          </tr>
                        <% end %>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            <% else %>
              <div class="alert alert-info mt-4" role="alert">
                <i class="fas fa-info-circle me-2"></i>
                <%= t('armories.material_collections.empty', material: @material_name) %>
              </div>
            <% end %>
          </main>
        </div>
      </div>
    </div>
  </body>
</html>
